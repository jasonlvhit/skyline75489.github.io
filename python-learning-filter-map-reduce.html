<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
在Python2.7中这是三个内置方法，可以对sequence(list,string,tuple)进行操作，返回类型和输入类型相同。在Python3.3中，filter，map和reduce全部变成了类，其中reduce还进入了functools包中，默认是找不到的，一些用法也和Python2.7中有所不同。

##1.filter

filter的名字已经暗示了它的作用——”过滤“，它用function过滤输入的sequence，返回在function里判定为True的成员。下面是tutorial里给出的例子。

*Python 2.7*

~~~~{python}
>>> def f(x): return x % 2 != 0 and x % 3 != 0
...
>>> filter(f, range(2, 25))
[5, 7, 11, 13, 17, 19, 23]
~~~~

*Python 3.3*

~~~~{python}
>>> def f(x): return x % 2 != 0  and x % 3 != 0

>>> list(filter(f,range(2,25)))
[5, 7, 11, 13, 17, 19, 23]
>>> 

~~~~

看了这个例子，我想到什么输出0-10000的所有素数，所以水仙花数之类的都可以这么来了，不需要循环，也不需要if-else，就是这么简单。

##2.map

map对一个或多个sequence执行function函数，将结果作为一个sequence返回。单看解释似乎不够清楚，还是看例子比较好。

~~~~{python}
>>> def cube(x): return x*x*x
...
>>> map(cube, range(1, 11))
[1, 8, 27, 64, 125, 216, 343, 512, 729, 1000]
~~~~

用map可以很容易地利用已有的sequence生成新的sequence。当用多个sequence构造新的sequence的时候，function接受的参数数量和后面sequence的数量必须相同，否则在Python 2.7中会报错。在Python3.3里使用map构造对象不报错，但当试图将map对象转换成list时报错，如下面所示。

*Python 2.7*

~~~~{python}
>>> seq = range(8)
>>> def add(x,y): return x+y

>>> map(add,seq,seq)
[0, 2, 4, 6, 8, 10, 12, 14]
>>> map(add,seq,seq,seq)

Traceback (most recent call last):
  File "<pyshell#38>", line 1, in <module>
    map(add,seq,seq,seq)
TypeError: add() takes exactly 2 arguments (3 given)
>>> 
~~~~

*Python 3.3*

~~~~{python}
>>> seq = range(8)
>>> def add(x,y): return x+y

>>> a = map(add,seq,seq,seq)
>>> a
<map object at 0x0202D950>
>>> list(a)
Traceback (most recent call last):
  File "<pyshell#9>", line 1, in <module>
    list(a)
TypeError: add() takes 2 positional arguments but 3 were given
>>> 
~~~~

当sequence长度不相等的时候，Python2.7中直接报错，因为它把不足的元素全部替换成了None，于是产生了类型不兼容。而在Python 3.3中，生成的sequence长度和最短的那个一致，其他多余的元素被丢弃。

*Python 2.7*

~~~~{python}
>>> seq1
[0, 1, 2, 3, 4, 5, 6, 7]
>>> seq2
[0, 2, 4, 6]
>>> map(add,seq1,seq2)

Traceback (most recent call last):
  File "<pyshell#48>", line 1, in <module>
    map(add,seq1,seq2)
  File "<pyshell#36>", line 1, in add
    def add(x,y): return x+y
TypeError: unsupported operand type(s) for +: 'int' and 'NoneType'
~~~~

*Python 3.3*

~~~~{python}
>>> list(seq1)
[0, 1, 2, 3, 4, 5, 6, 7]
>>> list(seq2)
[0, 2, 4, 6]
>>> list(map(add,seq1,seq2))
[0, 3, 6, 9]
>>> 
~~~~


##3.reduce

reduce将function作用于sequence上，每次对前两个元素产生作用，然后将生成的结果重新放回sequence里作为第一个元素，依次类推，最后得到一个结果。

~~~~{python}
>>> def add(x,y): return x+y
...
>>> reduce(add, range(1, 11))
55
~~~~

reduce还可以带第三个参数——初始值，作为结果的起点，同时当sequence为空时，初始值即为结果。如果没有设定初始值，那么当sequence为空时会报错。

~~~~{python}
>>> reduce(add,range(1,11),10)
65
>>> reduce(add,[],10)
10
>>> reduce(add,[])

Traceback (most recent call last):
  File "<pyshell#8>", line 1, in <module>
    reduce(add,[])
TypeError: reduce() of empty sequence with no initial value
>>>
~~~~




<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<p>在Python2.7中这是三个内置方法，可以对sequence(list,string,tuple)进行操作，返回类型和输入类型相同。在Python3.3中，filter，map和reduce全部变成了类，其中reduce还进入了functools包中，默认是找不到的，一些用法也和Python2.7中有所不同。</p>

<h2 id="1filter">1.filter</h2>

<p>filter的名字已经暗示了它的作用——”过滤“，它用function过滤输入的sequence，返回在function里判定为True的成员。下面是tutorial里给出的例子。</p>

<p><em>Python 2.7</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; <span class="token keyword">def</span> <span class="token number">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!</span><span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">and</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">!</span><span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
&gt;&gt;&gt; filter<span class="token punctuation">(</span><span class="token number">f</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span>
</code></pre>

<p><em>Python 3.3</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; <span class="token keyword">def</span> <span class="token number">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!</span><span class="token operator">=</span> <span class="token number">0</span>  <span class="token operator">and</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">!</span><span class="token operator">=</span> <span class="token number">0</span>

&gt;&gt;&gt; list<span class="token punctuation">(</span>filter<span class="token punctuation">(</span><span class="token number">f</span><span class="token punctuation">,</span>range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span>
&gt;&gt;&gt; 

</code></pre>

<p>看了这个例子，我想到什么输出0-10000的所有素数，所以水仙花数之类的都可以这么来了，不需要循环，也不需要if-else，就是这么简单。</p>

<h2 id="2map">2.map</h2>

<p>map对一个或多个sequence执行function函数，将结果作为一个sequence返回。单看解释似乎不够清楚，还是看例子比较好。</p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; <span class="token keyword">def</span> cube<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">*</span>x<span class="token operator">*</span>x
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
&gt;&gt;&gt; map<span class="token punctuation">(</span>cube<span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">343</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">729</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>
</code></pre>

<p>用map可以很容易地利用已有的sequence生成新的sequence。当用多个sequence构造新的sequence的时候，function接受的参数数量和后面sequence的数量必须相同，否则在Python 2.7中会报错。在Python3.3里使用map构造对象不报错，但当试图将map对象转换成list时报错，如下面所示。</p>

<p><em>Python 2.7</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; seq <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
&gt;&gt;&gt; <span class="token keyword">def</span> <span class="token number">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">+</span>y

&gt;&gt;&gt; map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span>
&gt;&gt;&gt; map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">)</span>

Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> 
    map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> <span class="token number">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> takes exactly <span class="token number">2</span> arguments <span class="token punctuation">(</span><span class="token number">3</span> given<span class="token punctuation">)</span>
&gt;&gt;&gt; 
</code></pre>

<p><em>Python 3.3</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; seq <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
&gt;&gt;&gt; <span class="token keyword">def</span> <span class="token number">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">+</span>y

&gt;&gt;&gt; <span class="token number">a</span> <span class="token operator">=</span> map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">,</span>seq<span class="token punctuation">)</span>
&gt;&gt;&gt; <span class="token number">a</span>

&gt;&gt;&gt; list<span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> 
    list<span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> <span class="token number">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">2</span> positional arguments but <span class="token number">3</span> were given
&gt;&gt;&gt; 
</code></pre>

<p>当sequence长度不相等的时候，Python2.7中直接报错，因为它把不足的元素全部替换成了None，于是产生了类型不兼容。而在Python 3.3中，生成的sequence长度和最短的那个一致，其他多余的元素被丢弃。</p>

<p><em>Python 2.7</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; seq1
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
&gt;&gt;&gt; seq2
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
&gt;&gt;&gt; map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq1<span class="token punctuation">,</span>seq2<span class="token punctuation">)</span>

Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> 
    map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq1<span class="token punctuation">,</span>seq2<span class="token punctuation">)</span>
  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token number">add</span>
    <span class="token keyword">def</span> <span class="token number">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">+</span>y
TypeError<span class="token punctuation">:</span> unsupported operand type<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token string">'int'</span> <span class="token operator">and</span> <span class="token string">'NoneType'</span>
</code></pre>

<p><em>Python 3.3</em></p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; list<span class="token punctuation">(</span>seq1<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
&gt;&gt;&gt; list<span class="token punctuation">(</span>seq2<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
&gt;&gt;&gt; list<span class="token punctuation">(</span>map<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>seq1<span class="token punctuation">,</span>seq2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
&gt;&gt;&gt; 
</code></pre>

<h2 id="3reduce">3.reduce</h2>

<p>reduce将function作用于sequence上，每次对前两个元素产生作用，然后将生成的结果重新放回sequence里作为第一个元素，依次类推，最后得到一个结果。</p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; <span class="token keyword">def</span> <span class="token number">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">+</span>y
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
&gt;&gt;&gt; reduce<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">55</span>
</code></pre>

<p>reduce还可以带第三个参数——初始值，作为结果的起点，同时当sequence为空时，初始值即为结果。如果没有设定初始值，那么当sequence为空时会报错。</p>

<pre class=" language-python"><code class=" language-python">&gt;&gt;&gt; reduce<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span>range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">65</span>
&gt;&gt;&gt; reduce<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">10</span>
&gt;&gt;&gt; reduce<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> 
    reduce<span class="token punctuation">(</span><span class="token number">add</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> reduce<span class="token punctuation">(</span><span class="token punctuation">)</span> of empty sequence <span class="token keyword">with</span> no initial value
&gt;&gt;&gt;
</code></pre>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
</script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "python-learning-filter-map-reduce.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
</body>
</html>
